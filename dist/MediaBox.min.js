!function(a){"use strict";var b={linear:function(a){return a},swing:function(a){return(1-Math.cos(a*Math.PI))/2},easeInQuad:function(a){return a*a},easeOutQuad:function(a){return a*(2-a)},easeInOutQuad:function(a){return.5>a?2*a*a:-1+(4-2*a)*a},easeInCubic:function(a){return a*a*a},easeOutCubic:function(a){return--a*a*a+1},easeInOutCubic:function(a){return.5>a?4*a*a*a:(a-1)*(2*a-2)*(2*a-2)+1},easeInQuart:function(a){return a*a*a*a},easeOutQuart:function(a){return 1- --a*a*a*a},easeInOutQuart:function(a){return.5>a?8*a*a*a*a:1-8*--a*a*a*a},easeInQuint:function(a){return a*a*a*a*a},easeOutQuint:function(a){return 1+--a*a*a*a*a},easeInOutQuint:function(a){return.5>a?16*a*a*a*a*a:1+16*--a*a*a*a*a}};a.Easing=b}(window),function(a,b){"use strict";var c={ease:Easing.linear,duration:600,from:0,to:0,delay:0,update:function(){},complete:function(){}},d=function(a){function d(){var b=Date.now()-f,c=h*a.ease(b/a.duration)+a.from;return"function"==typeof a.update&&a.update(c),b>a.duration?("function"==typeof a.complete&&a.complete(a.to),cancelAnimationFrame(g),g=null,!1):void(g=requestAnimationFrame(d))}a=a||{};for(var e in c)a[e]===b&&(a[e]=c[e]);var f,g,h=a.to-a.from;setTimeout(function(){f=Date.now(),d()},a.delay)};a.Tween=d}(window),function(a){"use strict";var b=function(){return this.init.apply(this,arguments)};b.prototype={constructor:b,STATE_STOPPED:0,STATE_STOPPING:1,STATE_PAUSED:2,STATE_PLAYING:3,_rHashQuery:/[#|?].*$/g,init:function(){this._channels={bgm:{},sfx:{},vid:{}},this._loaded=[],this._audio={},this._video={},this._audioPaused=!1,this._supported={audio:this._getAudioSupport(),video:this._getVideoSupport()}},createAudioContext:function(){var b;return a.AudioContext?b=a.AudioContext:a.webkitAudioContext&&(b=a.webkitAudioContext),b?new b:b},createGainNode:function(a){var b;return b=a.createGain?a.createGain():a.createGainNode()},isLoaded:function(a){var b=this._video[a]?this._video[a]:this._audio[a];return b.loaded===!0},isStopped:function(a){var b=this._video[a]?this._video[a]:this._audio[a];return b.state===this.STATE_STOPPED},isPlaying:function(a){var b=this._video[a]?this._video[a]:this._audio[a];return b.state===this.STATE_PLAYING},loadMedia:function(a,b){var c=new XMLHttpRequest,d=this;c.open("GET",a,!0),c.onreadystatechange=function(){if(4===this.readyState&&200===this.status){var a;try{a=JSON.parse(this.responseText)}catch(c){}a&&d.addMedia(a,b)}},c.send()},addMedia:function(a,b){var c=0,d=0,e=function(){c++,"function"==typeof b&&c===d&&b()};for(var f in a){d+=a[f].length;for(var g=a[f].length;g--;)this[f](a[f][g],e)}},addVideo:function(a,b){var c,d=this,e=a[0],f=function(){var a=document.createElement("source");a.src=d._video[e]._usedSource.source,a.type=d._getMimeFromMedia(d._video[e]._usedSource.source),d._video[e].loaded=!0,d._video[e].element.appendChild(a)};if(!this._video[e]){if(this._channels[a[2].channel]||(this._channels[a[2].channel]={}),this._video[e]={},this._video[e].channel=a[2].channel,this._video[e].loop=a[2].loop||!1,this._video[e].sources=a[1],this._video[e].element=document.createElement("video"),this._video[e].state=this.STATE_STOPPED,this._video[e].loaded=!1,this._video[e]._usedSource=this._getUsedMediaSource("video",this._video[e].sources),this._video[e]._events={},this._video[e].loop&&(this._video[e].element.loop=!0),-1!==this._loaded.indexOf(this._video[e]._usedSource.source)&&"function"==typeof b)return f(),void b();this._loaded.push(this._video[e]._usedSource.source),c=new XMLHttpRequest,c.open("GET",this._video[e]._usedSource.source,!0),c.onload=function(){f(),"function"==typeof b&&b()},c.send()}},getVideoProp:function(a,b){return this._video[a].element[b]},setVideoProp:function(a,b,c){this._video[a].element[b]=c},addVideoEvent:function(a,b,c){this._video[a]&&(this._video[a]._events[b]=function(){"function"==typeof c&&c.apply(this,arguments)},this._video[a].element.addEventListener(b,this._video[a]._events[b],!1))},removeVideoEvent:function(a,b){this._video[a]&&(this._video[a].element.removeEventListener(b,this._video[a]._events[b],!1),this._video[a]._events[b]=null)},getVideo:function(a){var b;return this._video[a]&&(b=this._video[a].element),b},getVideos:function(){var a=[];for(var b in this._video)a.push(this._video[b].element);return a},playVideo:function(a){this._video[a]&&this.isLoaded(a)&&this.isStopped(a)&&(this._video[a].element.volume=this._channels[this._video[a].channel].volume,this._video[a].element.play(),this._video[a].state=this.STATE_PLAYING)},pauseVideo:function(a){this._video[a]&&this.isLoaded(a)&&this.isPlaying(a)&&(this._video[a].element.pause(),this._video[a].state=this.STATE_PAUSED)},stopVideo:function(a){this._video[a]&&this.isLoaded(a)&&this.isPlaying(a)&&(this._video[a].element.pause(),this._video[a].state=this.STATE_STOPPED)},addAudio:function(a,b){var c,d=this,e=a[0];this._audio[e]||(this._channels[a[2].channel]||(this._channels[a[2].channel]={}),this._audio[e]={},this._audio[e].channel=a[2].channel,this._audio[e].loop=a[2].loop||!1,this._audio[e].sources=a[1],this._audio[e].context=this.createAudioContext(),this._audio[e].state=this.STATE_STOPPED,this._audio[e].loaded=!1,this._audio[e]._usedSource=this._getUsedMediaSource("audio",this._audio[e].sources),c=new XMLHttpRequest,c.open("GET",this._audio[e]._usedSource.source,!0),c.responseType="arraybuffer",c.onload=function(){d._audio[e].context.decodeAudioData(c.response,function(a){d._audio[e].loaded=!0,d._audio[e].startTime=0,d._audio[e].startOffset=0,d._audio[e].buffer=a,d._audio[e].gainNode=d.createGainNode(d._audio[e].context),"function"==typeof b&&b()})},c.send())},playAudio:function(a){this._audio[a]&&(this._audio[a].startTime=this._audio[a].context.currentTime,this._audio[a].source=this._audio[a].context.createBufferSource(),this._audio[a].source.buffer=this._audio[a].buffer,this._audio[a].source.connect(this._audio[a].gainNode),this._audio[a].gainNode.connect(this._audio[a].context.destination),this._audio[a].gainNode.gain.value=this._channels[this._audio[a].channel].volume||1,this._audio[a].loop&&(this._audio[a].source.loop=!0),this._sourceStart(this._audio[a]),this._audio[a].state=this.STATE_PLAYING)},hitAudio:function(a){this.playAudio(a)},stopAudio:function(a){this._audio[a]&&(this._audio[a].startTime=0,this._audio[a].startOffset=0,this._audio[a].state=this.STATE_STOPPED,this._sourceStop(this._audio[a]))},pauseAudio:function(a){this._audio[a]&&(this._audio[a].startOffset+=this._audio[a].context.currentTime-this._audio[a].startTime,this._audio[a].state=this.STATE_PAUSED,this._sourceStop(this._audio[a]))},fadeAudioIn:function(a,b,c){if(this._audio[a].state===this.STATE_PLAYING)return this;var d=this,e=this._channels[this._audio[a].channel].volume;this._audio[a]&&(this._audio[a].state===this.STATE_STOPPED?(this._audio[a].gainNode.gain.value=0,this.playAudio(a)):this._audio[a].state===this.STATE_STOPPING&&(this._audio[a].state=this.STATE_PLAYING),new Tween({to:e,from:0,ease:"function"==typeof c?c:Easing.linear,duration:b||1e3,update:function(b){d._audio[a].gainNode.gain.value=b},complete:function(b){d._audio[a].gainNode.gain.value=b}}))},fadeAudioOut:function(a,b,c){if(this._audio[a].state===this.STATE_STOPPING)return this;var d=this,e=function(b){d._audio[a].state===d.STATE_STOPPING&&(d._audio[a].gainNode.gain.value=b,0===d._audio[a].gainNode.gain.value&&d.stopAudio(a))};this._audio[a]&&(this._audio[a].state=this.STATE_STOPPING,new Tween({to:0,from:this._audio[a].gainNode.gain.value,ease:"function"==typeof c?c:Easing.linear,duration:b||1e3,update:e,complete:e}))},stopChannel:function(a){var b;for(b in this._video)this._video[b].channel===a&&this._video[b].state===this.STATE_PLAYING&&this.pauseVideo(b);for(b in this._audio)this._audio[b].channel===a&&this._audio[b].state===this.STATE_PLAYING&&this.pauseAudio(b)},playChannel:function(a){var b;for(b in this._video)this._video[b].channel===a&&this._video[b].state===this.STATE_PAUSED&&this.playVideo(b);for(b in this._audio)this._audio[b].channel===a&&this._audio[b].state===this.STATE_PAUSED&&this.playAudio(b)},fadeChannelOut:function(a,b){for(var c in this._audio)this._audio[c].channel===a&&this._audio[c].state===this.STATE_PLAYING&&this.fadeAudioOut(c,b)},fadeChannelIn:function(a,b){for(var c in this._audio)this._audio[c].channel===a&&this._audio[c].state===this.STATE_PAUSED&&this.fadeAudioIn(c,b)},crossFadeChannel:function(a,b,c){for(var d in this._audio)this._audio[d].channel===a&&this._audio[d].state===this.STATE_PLAYING&&this.fadeAudioOut(d,c);this.fadeAudioIn(b,c)},setChannelVolume:function(a,b){this._channels[a]&&(this._channels[a].volume=b)},pauseAll:function(a){if(this._audioPaused)return this;this._audioPaused=!0;for(var b in this._audio)this._audio[b].state===this.STATE_PLAYING&&this._audio[b].channel===a&&this.pauseAudio(b)},resumeAll:function(a){if(!this._audioPaused)return this;this._audioPaused=!1;for(var b in this._audio)this._audio[b].state===this.STATE_PAUSED&&this._audio[b].channel===a&&this.playAudio(b)},_sourceStart:function(a){a.source.start?a.source.start(0,a.startOffset%a.buffer.duration):a.source.noteOn(0,a.startOffset%a.buffer.duration)},_sourceStop:function(a){a.source.stop?a.source.stop(0):a.source.noteOff(0)},_getMimeFromMedia:function(a){var b;switch(a.split(".").pop().toLowerCase()){case"ogg":b="audio/ogg";break;case"mp3":b="audio/mpeg";break;case"webm":b="video/webm";break;case"mp4":b="video/mp4";break;case"ogv":b="video/ogg"}return b},_getUsedMediaSource:function(a,b){for(var c,d,e=b.length;e--;){var f=b[e].split(".").pop().toLowerCase().replace(this._rHashQuery,"");if("video"===a&&"mp4"===f?"probably"===this._supported.video.mpeg4||"probably"===this._supported.video.h264?(c=b[e],d="probably"):("maybe"===this._supported.video.mpeg4||"maybe"===this._supported.video.h264)&&(c=b[e],d="maybe"):"probably"===this._supported[a][f]?(c=b[e],d="probably"):"maybe"===this._supported[a][f]&&(c=b[e],d="maybe"),c)break}return{source:c,canPlay:d}},_getAudioSupport:function(){var a=document.createElement("audio"),b=/^no$/,c={};try{a.canPlayType&&(c.ogg=a.canPlayType('audio/ogg; codecs="vorbis"').replace(b,""),c.mp3=a.canPlayType("audio/mpeg;").replace(b,""),c.wav=a.canPlayType('audio/wav; codecs="1"').replace(b,""),c.m4a=(a.canPlayType("audio/x-m4a;")||a.canPlayType("audio/aac;")).replace(b,""))}catch(d){}return c},_getVideoSupport:function(){var a=document.createElement("video"),b=/^no$/,c={};try{a.canPlayType&&(c.mpeg4=a.canPlayType('video/mp4; codecs="mp4v.20.8"').replace(b,""),c.ogg=a.canPlayType('video/ogg; codecs="theora"').replace(b,""),c.h264=a.canPlayType('video/mp4; codecs="avc1.42E01E"').replace(b,""),c.webm=a.canPlayType('video/webm; codecs="vp8, vorbis"').replace(b,""))}catch(d){}return c}},a.MediaBox=b}(window);