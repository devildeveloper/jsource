!function(a,b){"use strict";var c={ease:Easing.linear,duration:600,from:0,to:0,delay:0,update:function(){},complete:function(){}},d=function(a){function d(){var b=Date.now()-f,c=h*a.ease(b/a.duration)+a.from;return"function"==typeof a.update&&a.update(c),b>a.duration?("function"==typeof a.complete&&a.complete(a.to),cancelAnimationFrame(g),g=null,!1):void(g=requestAnimationFrame(d))}a=a||{};for(var e in c)a[e]===b&&(a[e]=c[e]);var f,g,h=a.to-a.from;setTimeout(function(){f=Date.now(),d()},a.delay)};a.Tween=d}(window),function(a){"use strict";var b=/[#|?].*$/g,c=/^no$/,d=function(a){return"function"==typeof a},e=function(){var a=document.createElement("audio"),b={};try{a.canPlayType&&(b.ogg=a.canPlayType('audio/ogg; codecs="vorbis"').replace(c,""),b.mp3=a.canPlayType("audio/mpeg;").replace(c,""),b.wav=a.canPlayType('audio/wav; codecs="1"').replace(c,""),b.m4a=(a.canPlayType("audio/x-m4a;")||a.canPlayType("audio/aac;")).replace(c,""))}catch(d){}return b},f=function(){var a=document.createElement("video"),b={};try{a.canPlayType&&(b.mpeg4=a.canPlayType('video/mp4; codecs="mp4v.20.8"').replace(c,""),b.ogg=a.canPlayType('video/ogg; codecs="theora"').replace(c,""),b.h264=a.canPlayType('video/mp4; codecs="avc1.42E01E"').replace(c,""),b.webm=a.canPlayType('video/webm; codecs="vp8, vorbis"').replace(c,""))}catch(d){}return b},g=function(a){a.source.start?a.source.start(0,a.startOffset%a.buffer.duration):a.source.noteOn(0,a.startOffset%a.buffer.duration)},h=function(a){a.source.stop?a.source.stop(0):a.source.noteOff(0)},i=function(a){var b;switch(a.split(".").pop().toLowerCase()){case"ogg":b="audio/ogg";break;case"mp3":b="audio/mpeg";break;case"webm":b="video/webm";break;case"mp4":b="video/mp4";break;case"ogv":b="video/ogg"}return b},j=function(a,c){for(var d,e,f=c.length;f--;){var g=c[f].split(".").pop().toLowerCase().replace(b,"");if("video"===a&&"mp4"===g?"probably"===k.support.video.mpeg4||"probably"===k.support.video.h264?(d=c[f],e="probably"):("maybe"===k.support.video.mpeg4||"maybe"===k.support.video.h264)&&(d=c[f],e="maybe"):"probably"===k.support[a][g]?(d=c[f],e="probably"):"maybe"===k.support[a][g]&&(d=c[f],e="maybe"),d)break}return{source:d,canPlay:e}},k=function(){return this.init.apply(this,arguments)};k.support={audio:e(),video:f()},k.STATE_STOPPED=0,k.STATE_STOPPING=1,k.STATE_PAUSED=2,k.STATE_PLAYING=3,k.prototype={constructor:k,init:function(){this._channels={bgm:{},sfx:{},vid:{}},this._urls=[],this._audio={},this._video={},this._audioPaused=!1,this._mediaCount=0,this._mediaLoads=0,this._progressHandler=null},createAudioContext:function(){var b;return a.AudioContext?b=a.AudioContext:a.webkitAudioContext&&(b=a.webkitAudioContext),b?new b:b},createGainNode:function(a){var b;return b=a.createGain?a.createGain():a.createGainNode()},isLoaded:function(a){var b=this._video[a]?this._video[a]:this._audio[a];return b.loaded===!0},isStopped:function(a){var b=this._video[a]?this._video[a]:this._audio[a];return b.state===k.STATE_STOPPED},isPlaying:function(a){var b=this._video[a]?this._video[a]:this._audio[a];return b.state===k.STATE_PLAYING},loadMedia:function(a,b){var c=new XMLHttpRequest,d=this;c.open("GET",a,!0),c.onreadystatechange=function(){if(4===this.readyState&&200===this.status){var a;try{a=JSON.parse(this.responseText)}catch(c){}a&&d.addMedia(a,b)}},c.send()},addMedia:function(a,b){var c=0,e=0,f=function(){c++,d(b)&&c===e&&b()};for(var g in a){e+=a[g].length,this._mediaCount=e;for(var h=a[g].length;h--;)this[g](a[g][h],f)}},addProgress:function(a){this._progressHandler=a},addVideo:function(a,b){var c,e=this,f=a[0],g=function(){e._processLoaded();var a=document.createElement("source");a.src=e._video[f]._usedSource.source,a.type=i(e._video[f]._usedSource.source),e._video[f].loaded=!0,e._video[f].element.appendChild(a)};if(!this._video[f]){if(this._channels[a[2].channel]||(this._channels[a[2].channel]={}),this._video[f]={},this._video[f].channel=a[2].channel,this._video[f].loop=a[2].loop||!1,this._video[f].sources=a[1],this._video[f].element=document.createElement("video"),this._video[f].state=k.STATE_STOPPED,this._video[f].loaded=!1,this._video[f]._usedSource=j("video",this._video[f].sources),this._video[f]._events={},this._video[f].loop&&(this._video[f].element.loop=!0),-1!==this._urls.indexOf(this._video[f]._usedSource.source)&&d(b))return g(),void b();this._urls.push(this._video[f]._usedSource.source),c=new XMLHttpRequest,c.open("GET",this._video[f]._usedSource.source,!0),c.onload=function(){g(),d(b)&&b()},c.send()}},getVideoProp:function(a,b){return this._video[a].element[b]},setVideoProp:function(a,b,c){this._video[a].element[b]=c},addVideoEvent:function(a,b,c){this._video[a]&&(this._video[a]._events[b]=function(){d(c)&&c.apply(this,arguments)},this._video[a].element.addEventListener(b,this._video[a]._events[b],!1))},removeVideoEvent:function(a,b){this._video[a]&&(this._video[a].element.removeEventListener(b,this._video[a]._events[b],!1),this._video[a]._events[b]=null)},getVideo:function(a){var b;return this._video[a]&&(b=this._video[a].element),b},getVideos:function(){var a=[];for(var b in this._video)a.push(this._video[b].element);return a},playVideo:function(a){this._video[a]&&this.isLoaded(a)&&this.isStopped(a)&&(this._video[a].element.volume=this._channels[this._video[a].channel].volume,this._video[a].element.play(),this._video[a].state=k.STATE_PLAYING)},pauseVideo:function(a){this._video[a]&&this.isLoaded(a)&&this.isPlaying(a)&&(this._video[a].element.pause(),this._video[a].state=k.STATE_PAUSED)},stopVideo:function(a){this._video[a]&&this.isLoaded(a)&&this.isPlaying(a)&&(this._video[a].element.pause(),this._video[a].state=k.STATE_STOPPED)},addAudio:function(a,b){var c,e=this,f=a[0];this._audio[f]||(this._channels[a[2].channel]||(this._channels[a[2].channel]={}),this._audio[f]={},this._audio[f].channel=a[2].channel,this._audio[f].loop=a[2].loop||!1,this._audio[f].sources=a[1],this._audio[f].context=this.createAudioContext(),this._audio[f].state=k.STATE_STOPPED,this._audio[f].loaded=!1,this._audio[f]._usedSource=j("audio",this._audio[f].sources),c=new XMLHttpRequest,c.open("GET",this._audio[f]._usedSource.source,!0),c.responseType="arraybuffer",c.onload=function(){e._audio[f].context.decodeAudioData(c.response,function(a){e._processLoaded(),e._audio[f].loaded=!0,e._audio[f].startTime=0,e._audio[f].startOffset=0,e._audio[f].buffer=a,e._audio[f].gainNode=e.createGainNode(e._audio[f].context),d(b)&&b()})},c.send())},playAudio:function(a){this._audio[a]&&(this._audio[a].startTime=this._audio[a].context.currentTime,this._audio[a].source=this._audio[a].context.createBufferSource(),this._audio[a].source.buffer=this._audio[a].buffer,this._audio[a].source.connect(this._audio[a].gainNode),this._audio[a].gainNode.connect(this._audio[a].context.destination),this._audio[a].gainNode.gain.value=this._channels[this._audio[a].channel].volume||1,this._audio[a].loop&&(this._audio[a].source.loop=!0),g(this._audio[a]),this._audio[a].state=k.STATE_PLAYING)},hitAudio:function(a){this.playAudio(a)},stopAudio:function(a){this._audio[a]&&(this._audio[a].startTime=0,this._audio[a].startOffset=0,this._audio[a].state=k.STATE_STOPPED,h(this._audio[a]))},pauseAudio:function(a){this._audio[a]&&(this._audio[a].startOffset+=this._audio[a].context.currentTime-this._audio[a].startTime,this._audio[a].state=k.STATE_PAUSED,h(this._audio[a]))},fadeAudioIn:function(a,b,c){if(this._audio[a].state===k.STATE_PLAYING)return this;var e=this,f=this._channels[this._audio[a].channel].volume;this._audio[a]&&(this._audio[a].state===k.STATE_STOPPED?(this._audio[a].gainNode.gain.value=0,this.playAudio(a)):this._audio[a].state===k.STATE_STOPPING&&(this._audio[a].state=k.STATE_PLAYING),new Tween({to:f,from:0,ease:d(c)?c:Easing.linear,duration:b||1e3,update:function(b){e._audio[a].gainNode.gain.value=b},complete:function(b){e._audio[a].gainNode.gain.value=b}}))},fadeAudioOut:function(a,b,c){if(this._audio[a].state===k.STATE_STOPPING)return this;var e=this,f=function(b){e._audio[a].state===e.STATE_STOPPING&&(e._audio[a].gainNode.gain.value=b,0===e._audio[a].gainNode.gain.value&&e.stopAudio(a))};this._audio[a]&&(this._audio[a].state=k.STATE_STOPPING,new Tween({to:0,from:this._audio[a].gainNode.gain.value,ease:d(c)?c:Easing.linear,duration:b||1e3,update:f,complete:f}))},stopChannel:function(a){var b;for(b in this._video)this._video[b].channel===a&&this._video[b].state===k.STATE_PLAYING&&this.pauseVideo(b);for(b in this._audio)this._audio[b].channel===a&&this._audio[b].state===k.STATE_PLAYING&&this.pauseAudio(b)},playChannel:function(a){var b;for(b in this._video)this._video[b].channel===a&&this._video[b].state===k.STATE_PAUSED&&this.playVideo(b);for(b in this._audio)this._audio[b].channel===a&&this._audio[b].state===k.STATE_PAUSED&&this.playAudio(b)},fadeChannelOut:function(a,b){for(var c in this._audio)this._audio[c].channel===a&&this._audio[c].state===k.STATE_PLAYING&&this.fadeAudioOut(c,b)},fadeChannelIn:function(a,b){for(var c in this._audio)this._audio[c].channel===a&&this._audio[c].state===k.STATE_PAUSED&&this.fadeAudioIn(c,b)},crossFadeChannel:function(a,b,c){for(var d in this._audio)this._audio[d].channel===a&&this._audio[d].state===k.STATE_PLAYING&&this.fadeAudioOut(d,c);this.fadeAudioIn(b,c)},setChannelVolume:function(a,b){this._channels[a]&&(this._channels[a].volume=b)},pauseAll:function(a){if(this._audioPaused)return this;this._audioPaused=!0;for(var b in this._audio)this._audio[b].state===k.STATE_PLAYING&&this._audio[b].channel===a&&this.pauseAudio(b)},resumeAll:function(a){if(!this._audioPaused)return this;this._audioPaused=!1;for(var b in this._audio)this._audio[b].state===k.STATE_PAUSED&&this._audio[b].channel===a&&this.playAudio(b)},_processLoaded:function(){this._mediaLoads++,d(this._progressHandler)&&this._progressHandler({total:this._mediaCount,loaded:this._mediaLoads,decimalPercent:this._mediaLoads/this._mediaCount,wholePercent:this._mediaLoads/this._mediaCount*100}),this._mediaLoads===this._mediaCount&&(this._mediaCount=0,this._mediaLoads=0)}},a.MediaBox=k}(window);