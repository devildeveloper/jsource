!function(a,b){"use strict";var c=function(){return this.init.apply(this,arguments)};c.prototype={constructor:c,_rHash:/#/,_rHTTPs:/^http[s]?:\/\/.*?\//,_enabled:!1,_pushable:"history"in a&&"pushState"in a.history,_hashable:"onhashchange"in a,_ishashpushed:!1,_uid:0,_states:{},_responses:{},_callbacks:{pop:[],before:[],after:[]},_async:!0,_caching:!0,init:function(c){var d=a.location.href;this._states[d]={uid:this._getUid(),cached:!1},c.async!==b&&(this._async=c.async),c.caching!==b&&(this._caching=c.caching),this._stateEnable()},push:function(a,b){var c=this;this._fire("before"),this._stateCached(a)?(this._push(a),b(this._responses[a])):(this._states[a]={uid:this._getUid(),cached:!1},this._async?this._getUrl(a,function(d){c._push(a),c._fire("after",d),"function"==typeof b&&b(d)}):(this._push(a),this._fire("after"),"function"==typeof b&&b()))},onBeforeState:function(a){this._bind("before",a)},onAfterState:function(a){this._bind("after",a)},onPopState:function(a){this._bind("pop",a)},goBack:function(){this._history.back(),this._fire("back")},goForward:function(){this._history.forward(),this._fire("forward")},_push:function(b){this._pushable?a.history.pushState(this._states[b],"",b):(this._ishashpushed=!0,a.location.hash=b.replace(this._rHTTPs,""))},_stateCached:function(a){var b=!1;return this._caching&&this._states[a]&&this._states[a].cached&&this._responses[a]&&(b=!0),b},_cacheState:function(a,b){this._caching&&(this._states[a].cached=!0,this._responses[a]=b)},_getUid:function(){return this._uid=this._uid+1,this._uid},_getUrl:function(a,b){var c=new XMLHttpRequest,d=this;c.open("GET",a,!0),c.onreadystatechange=function(){if(4===this.readyState)if(200===this.status)try{d._cacheState(a,this),"function"==typeof b&&b(this)}catch(c){}else 404===this.status},c.send()},_bind:function(a,b){this._callbacks[a]&&"function"==typeof b&&this._callbacks[a].push(b)},_fire:function(a){for(var b=this._callbacks[a].length;b--;)this._callbacks[a][b].apply(this,[].slice.call(arguments,1))},_stateEnable:function(){if(this._enabled)return this;var b=this,c=function(){var c=a.location.href.replace(b._rHash,"/");b._stateCached(c)?b._fire("pop",c,b._responses[c]):b._getUrl(c,function(a){b._fire("pop",c,a)})};this._enabled=!0,this._pushable?a.addEventListener("popstate",function(){c()},!1):this._hashable&&a.addEventListener("hashchange",function(){b._ishashpushed?b._ishashpushed=!1:c()},!1)}},a.PushState=c}(window);